{% extends 'base.html' %}

{% block title %}- Costos Indirectos{% endblock %}

{% block content %}
<style>
    /* GRID RESPONSIVO PARA EL FORMULARIO */
    .form-grid-layout {
        display: grid;
        grid-template-columns: 2fr 1.5fr 1fr auto; /* 4 columnas definidas */
        gap: 15px;
        align-items: end; /* Alinea los inputs y el botón abajo */
    }

    /* En pantallas pequeñas, que se ponga uno debajo del otro */
    @media (max-width: 768px) {
        .form-grid-layout {
            grid-template-columns: 1fr;
        }
        .form-grid-layout button {
            width: 100%;
        }
    }
</style>

<div class="container" style="max-width: 900px; margin: 40px auto;">

    <div style="text-align: center; margin-bottom: 30px;">
        <h2 style="color: var(--primary-blue); font-weight: bold; margin-bottom: 10px;">
            <i class="fas fa-tags" style="color: #d63384;"></i> Maestro de Costos Indirectos
        </h2>
        <p style="color: #666; font-size: 1.1em;">
            Configura aquí los costos adicionales (Cajas, Delivery, Gas, Mano de Obra) <br>
            que estarán disponibles para asignar a tus productos.
        </p>
    </div>

    <div class="card-style" style="padding: 30px; border-top: 5px solid #d63384; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
        
        <div style="background-color: #fff0f6; padding: 20px; border-radius: 12px; border: 1px dashed #f8bbd0; margin-bottom: 30px;">
            <h4 style="margin-top: 0; color: #880e4f; font-size: 1.1em; margin-bottom: 15px;">
                <i class="fas fa-plus-circle"></i> Nuevo Concepto de Costo
            </h4>
            
            <form method="POST" class="form-grid-layout">
                {% csrf_token %}
                <input type="hidden" name="add_costo" value="1">
                
                <div style="width: 100%;">
                    <label style="font-weight: bold; font-size: 0.9em; color: #555; margin-bottom: 5px; display: block;">Nombre del Costo</label>
                    {{ form_costo.nombre }}
                </div>

                <div style="width: 100%;">
                    <label style="font-weight: bold; font-size: 0.9em; color: #555; margin-bottom: 5px; display: block;">Tipo de Cálculo</label>
                    {{ form_costo.tipo }}
                </div>

                <div style="width: 100%;">
                    <label style="font-weight: bold; font-size: 0.9em; color: #555; margin-bottom: 5px; display: block;">Valor Defecto</label>
                    {{ form_costo.valor_defecto }}
                </div>

                <div>
                    <button type="submit" class="add-btn" style="background-color: #d63384; border: none; padding: 10px 20px; height: 38px; display: flex; align-items: center; justify-content: center; white-space: nowrap;">
                        <i class="fas fa-save" style="margin-right: 5px;"></i> Agregar
                    </button>
                </div>
            </form>
        </div>

        <h4 style="color: #333; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px;">
            Listado de Costos Activos
        </h4>

        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: separate; border-spacing: 0 8px;">
                <thead>
                    <tr style="color: #666; font-size: 0.9em; text-transform: uppercase;">
                        <th style="text-align: left; padding: 10px;">Nombre</th>
                        <th style="text-align: center; padding: 10px;">Tipo</th>
                        <th style="text-align: right; padding: 10px;">Valor</th>
                        <th style="text-align: right; padding: 10px;">Acción</th>
                    </tr>
                </thead>
                <tbody>
                    {% for costo in lista_costos %}
                    <tr style="background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.03); transition: transform 0.2s;">
                        <td style="padding: 15px; border-radius: 8px 0 0 8px; border-left: 4px solid {% if costo.tipo == 'FIJO' %}#198754{% else %}#0dcaf0{% endif %}; font-weight: 600; color: #333;">
                            {{ costo.nombre }}
                        </td>
                        
                        <td style="padding: 15px; text-align: center;">
                            {% if costo.tipo == 'FIJO' %}
                                <span style="background: #d1e7dd; color: #0f5132; padding: 5px 12px; border-radius: 20px; font-size: 0.85em; font-weight: bold;">
                                    Fijo ($)
                                </span>
                            {% else %}
                                <span style="background: #cff4fc; color: #055160; padding: 5px 12px; border-radius: 20px; font-size: 0.85em; font-weight: bold;">
                                    % Receta
                                </span>
                            {% endif %}
                        </td>
                        
                        <td style="padding: 15px; text-align: right; font-family: monospace; font-size: 1.1em; font-weight: bold;">
                            {{ costo.valor_defecto }}
                        </td>
                        
                        <td style="padding: 15px; text-align: right; border-radius: 0 8px 8px 0;">
                            <form method="POST" onsubmit="return confirm('¿Estás seguro de eliminar \'{{ costo.nombre }}\'?');" style="margin: 0;">
                                {% csrf_token %}
                                <input type="hidden" name="delete_costo" value="1">
                                <input type="hidden" name="costo_id" value="{{ costo.id }}">
                                <button type="submit" style="background: #ffebee; color: #c62828; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; transition: background 0.2s;" title="Eliminar">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 40px; color: #999; background: #f9f9f9; border-radius: 8px;">
                            <i class="fas fa-box-open" style="font-size: 3em; margin-bottom: 10px; opacity: 0.5;"></i><br>
                            No hay costos configurados aún.<br>Agrega el primero usando el formulario de arriba.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>

<style>
    tbody tr:hover {
        transform: scale(1.01);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1) !important;
    }
</style>
{% endblock %}